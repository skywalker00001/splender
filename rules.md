胜利分数：18分。（这个可以在房间里面设置，默认是18分。）



游戏规则为，一个玩家的一个回合内《能且只能》做一个动作，这个动作是：买卡，拿球，预购中的一个。然后做完这个动作，回合自动结束。回合结束后需自动检查当前能否满足进化条件。如果满足进化条件，玩家可以最多选择一个卡牌进行进化（或者不进化），然后完成进化动作；如果不满足进化条件直接跳过进化阶段。完成进化动作以后去检查当前玩家是否大于等于18分。如果大于胜利分数（18）分就提示所有人当前游戏进入最后一轮。当最后一名玩家（玩家4）结束回合然后结束进化以后统计所有人的分数，进行胜利排序。

首先按照分数排名，分高的在前。同分的话按照谁后手谁靠前（比如玩家2玩家3都是19分，那么玩家3在玩家2的前面，这就是同分玩家越靠后排名越高）。

* I 回合开始，选择动作
一，如果是拿球，会有两种不同的选择：拿同色球或者拿不同色的球。
1.1
如果拿球拿同色，只能拿2个球，而求需要判断这个颜色的球的秋堆余量是否大于等于4。如果小于4就不能拿这个颜色的同色2球（显示拿球失败，然后我们重新选择动作）。

1.2
如果拿球拿不同颜色，最多只能拿3个不同颜色球。什么叫最多呢？也就是当球堆有大于等于三个球的时候，我们必须拿3个颜色的球。如果球堆只有小于3个颜色（比如只有黑色和红色），那么我们就可以并且只可以拿这剩余的n个颜色的各1各球（比如黑色和红色）。

1.3
拿完球必须检查当前所持球的总数是否小于等于10（包括大师球在内）。如果超过10枚需要选择任意球（包括大师球）放回球队，让球数=10。比如我一开始是9枚球，拿完3个不同颜色的球是12枚，那么拿完球系统提示：当前球为12枚，所持上限为10枚，需放回2枚球。然后等待我点击自己的球堆（点击一下意思是要放回什么颜色的球一枚）。当要放回的球总数等于需放回的总数（比如这里是2枚），我们的放回按钮从灰色（不可以点击）变成非灰色，意思就是我们满足放回的条件，就可以进行放回了。注意这里如果满足了“要放回的球总数等于需放回的总数”，我们就不能再点击自己的球进行放回了。 如果要重新选择，请点击 “放回”按钮旁边的“清除”按钮，去重新从0选择需要放回的球。


二，如果是买卡。
如果点击一张卡，他有两个按钮（购买/预购）。首先我们讨论购买。这个按钮只有满足购买条件，购买button才能是亮的。
购买条件：
2.1 先算卡牌实际消耗
卡牌实际消耗 = 卡牌每个颜色的花费 - 当前玩家每个颜色的抵扣 

2.2 预计算购买手中颜色与卡牌实际消耗 的差。
相差数 = 卡牌实际消耗  - 手中每个颜色拥有的实际球数量。 如果 某种颜色 差值大于0，表明手中此颜色的球绰绰有余，于是把此颜色差值 = 0 。

相差数所有颜色求和，如果这个和 大于 我们的大师球（万能球），代表即使我们用了大师球当赖子也无法满足购买要求。购买的按钮就不亮。

注意，只有点击一张卡我们才会对此卡购买进行预计算

3.3
如果购买的按钮是亮的，表明我们通过预计算，这张卡可以被我们购买下。因此我们点击购买需要再弹出一个三排的框+一个新的灰色购买按钮，上面是 消耗颜色（这个是实际净消耗，扣除了对应的颜色的抵扣的，注意不能小于0）；中间是我们拥有的所持球。 
然后下面是，我们可以通过+、- 调整的实际花费的球。注意这里有大师球（赖子）可以充当任意一种球的方案，可能逻辑比较复杂一些。
当我们把所有的球调整为可以支付的时候，这三排下面的购买框就由灰转亮了。我们就可以实际购买了（注意后台扣除相应的买花费的球）。

三，如果是预购
3.1 首先检查当前玩家预购区是否大于等于3张，如果大于等于3张，预购的按钮是灰的。
3.2 
如果小于3张，我们可以预购。注意，如果当前大师球是0，我们需要弹出一个确认框：“当前大师球数量为0，是否仅预购？”

3.3
否则，我们当前玩家的大师球数量+1，然后把这张预购卡拿走放到预购区。注意，L4/L5的卡牌不可以被预购，然后预购也可以预购当前牌堆顶的一张牌（盲预购）。然后回合结束。

**II 回合结束，检查进化
玩家进行了三选一的动作以后自动结束回合，结束回合需要对此玩家拥有的所有卡牌进行检查，看能否进化。如果全都不能，跳过进化阶段；否则，最多选择一个进行进化（也可以选择不进化）。

检查逻辑：顺序遍历全部的拥有卡牌。
    - 检查这张牌的下一级进化目标是否存在场上（注意，只有1/2级能够进化成相应的2/3级卡牌），因此，如果这张卡不是1/2级就可以跳过这张卡了。 对于1级的卡，只需要检测2级桌上卡池和自己的预购卡池中是否有次卡的进化目标。2级卡只需要检测桌上3级卡池和自己的预购卡池。

    - 如果满足上一个条件，证明这张卡有进化目标。还需要再检查进化所需要的抵扣球是否满足条件。比如 “蚊香蝌蚪 ->蚊香君,蓝,2”也就是说它进化需要至少2个蓝色的抵扣球。我们就必须在抵扣区有超过两个蓝色的球才能进化。注意，这里必须用抵扣球进行进化，不能消耗我们手中的精灵球。

如果至少有一张卡牌满足这个检查逻辑，证明我们可以进化。于是玩家可以通过先点击 手中的要进化的牌，再点击他要进化的牌（如果有多张可以进化的牌那么由玩家来选择）。当玩家连续点击了两张牌以后，我们就需要再核实一下是否满足进化逻辑。如果满足，进化的按钮就由灰转亮，把那张牌放到用户的手中，原来的牌丢弃。

注意，我们进化阶段一直有两个按钮，一个是进化（通常为灰色，除非用户连续点击的两张牌满足我们的进化逻辑），另一个是跳过进化（如果点击此，我们需要再跳出一个二次确认框，问玩家：您是否跳过进化？）

如果玩家确认跳过进化，或者玩家进化了一个可以被进化的精灵，此进化阶段结束。


***III 检查分数
不管是买牌还是进化，我们都要及时的更新玩家对应的分数。在一个玩家的进化阶段结束（被直接跳过也算是进化阶段结束），我们检查他对应的分数是否大于等于18分。如果大于等于18分，代表游戏只剩最后一轮要结束（注意，这个检查分数如果一旦大于等于18分，is_last_turn=True了以后就不需要再检查了）。在最后一个玩家结束了这一轮（is_last_turn=True and is_last_player=True）以后，我们进行数据统计。


数据统计：
先按照分数进行排名，同分按照后面的玩家排名更高的逻辑。