# 🔧 璀璨宝石宝可梦 - 调试系统使用说明

## 📖 简介

这是一个强大的游戏内调试系统，用于开发和测试。可以方便地修改游戏状态，包括：
- 调整玩家持有的球（从球池拿取）
- 修改永久折扣
- 添加已拥有的卡牌或预定卡牌
- 支持从场上或牌堆添加卡牌

## 🚀 启用调试模式

### 方法一：键盘快捷键（推荐）

在游戏界面按下 **`Ctrl + Shift + D`** 即可显示/隐藏调试按钮。

### 方法二：手动修改代码

编辑 `/home/work/houyi/pj_25_q4/splendor/web/main.html`，找到：

```html
<button id="toggle-debug-btn" class="btn btn-secondary btn-small" style="display: none;">🔧 调试</button>
```

将 `display: none;` 改为 `display: inline-block;` 即可永久显示调试按钮。

## 🎮 使用方法

### 1. 启用调试按钮

- 按下 `Ctrl + Shift + D`
- 会看到提示："🔧 调试模式已启用"
- 游戏界面右上角会出现 **"🔧 调试"** 按钮

### 2. 打开调试面板

- 开始游戏后，点击 **"🔧 调试"** 按钮
- 调试面板会弹出，显示三个主要功能区

### 3. 功能区说明

#### 🎨 添加持有球

- 显示当前玩家所有类型的球的数量
- 点击 **+** 按钮：从球池拿取1个该颜色的球
- 点击 **-** 按钮：将1个球放回球池
- 支持所有6种球类型（黑、粉、黄、蓝、红、大师球）

**注意事项：**
- 增加球时会从球池扣除，如果球池不足会自动限制
- 减少球时会放回球池
- 不会触发10球上限检查（调试用）

#### 💎 修改永久折扣

- 显示当前玩家的永久折扣（5种颜色球，不包括大师球）
- 点击 **+** 按钮：增加1点该颜色的永久折扣
- 点击 **-** 按钮：减少1点该颜色的永久折扣

**实现方式：**
- 增加折扣时会添加一张虚拟卡牌（0分，只提供折扣）
- 虚拟卡牌的名称为 "调试折扣(颜色)"
- 可以在已拥有卡牌列表中看到

#### 🎴 添加卡牌

##### Tab切换
- **已拥有**：将卡牌添加到玩家的展示区（display_area）
- **预定**：将卡牌添加到玩家的预定区（reserved_cards，最多3张）

##### 卡牌来源
- **从场上**：
  - 显示当前场上的所有卡牌（Lv1-3的12张+稀有+传说）
  - 点击"添加"后，会从场上移除该卡牌并自动补充
  - 场上卡牌减少，牌堆相应减少
  
- **从牌堆**：
  - 选择等级（Lv1/Lv2/Lv3），显示剩余牌堆数量
  - 点击"添加"后，从牌堆顶随机抽取一张
  - 牌堆数量减1
  - **注意**：无法预览牌堆中的卡牌，抽取是随机的

### 4. 关闭调试面板

点击面板右上角的 **✕** 按钮即可关闭。

## 💡 使用场景示例

### 场景1：测试高分获胜
```
1. 打开调试面板
2. 在"添加卡牌"中选择"已拥有"
3. 从场上连续添加高分卡牌
4. 观察游戏结束逻辑
```

### 场景2：测试进化功能
```
1. 添加一张可进化的基础卡牌（如妙蛙种子）
2. 增加对应颜色的永久折扣至满足进化条件
3. 在游戏中触发进化
```

### 场景3：测试购买逻辑
```
1. 增加特定颜色的持有球
2. 增加对应的永久折扣
3. 测试购买各种成本的卡牌
```

### 场景4：测试预定功能
```
1. 在"添加卡牌"中选择"预定"
2. 从场上添加3张卡牌到预定区
3. 测试购买预定卡牌的逻辑
```

## ⚠️ 注意事项

1. **仅供开发测试使用**
   - 不要在正式游戏中启用
   - 会破坏游戏平衡

2. **操作顺序**
   - 必须先开始游戏才能使用调试功能
   - 调试操作会立即生效，界面会自动更新

3. **球池限制**
   - 添加球时受球池数量限制
   - 如果球池为0，则无法继续添加

4. **卡牌限制**
   - 预定区最多3张卡牌
   - 从场上添加会触发自动补充
   - 从牌堆添加会减少牌堆数量

5. **游戏状态**
   - 调试操作不会结束当前回合
   - 不会触发AI行动
   - 不会记录到游戏历史

6. **隐藏调试按钮**
   - 按 `Ctrl + Shift + D` 可以随时显示/隐藏调试按钮
   - 适合在需要时临时启用

## 🔒 安全性

- 调试功能默认完全隐藏
- 需要通过快捷键或修改代码才能启用
- 普通玩家无法访问

## 🛠️ 技术实现

### 前端
- **HTML**: `/web/main.html` - 调试面板结构
- **CSS**: `/web/static/css/style.css` - 调试面板样式
- **JavaScript**: `/web/static/js/debug.js` - 调试面板逻辑
- **API**: `/web/static/js/api.js` - 调试API封装

### 后端
- **API端点**: `/backend/app.py`
  - `/api/rooms/<room_id>/debug/adjust_balls` - 调整持有球
  - `/api/rooms/<room_id>/debug/adjust_permanent_balls` - 调整永久折扣
  - `/api/rooms/<room_id>/debug/add_card` - 从场上添加卡牌
  - `/api/rooms/<room_id>/debug/add_card_from_deck` - 从牌堆添加卡牌

## 📝 更新日志

### v1.0.0 (2025-10-19)
- ✅ 实现持有球调整功能
- ✅ 实现永久折扣调整功能
- ✅ 实现从场上添加卡牌功能
- ✅ 实现从牌堆添加卡牌功能
- ✅ 支持已拥有/预定两种模式
- ✅ 自动处理场上补充和牌堆数量变化
- ✅ 快捷键显示/隐藏功能

## 📧 反馈

如有问题或建议，请联系开发团队。

---

**Enjoy debugging! 🎮✨**

